# Minimal release image using pre-built binaries
# Used by CI - no Rust compilation, no QEMU emulation

# Grab CA certs from Alpine
FROM alpine:latest AS certs
RUN apk add --no-cache ca-certificates

FROM scratch
COPY --from=certs /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/

ARG TARGETARCH
COPY mqlite-${TARGETARCH} /mqlite
COPY mqlite.toml /etc/mqlite/mqlite.toml

EXPOSE 1883 8883 9090
ENTRYPOINT ["/mqlite", "-c", "/etc/mqlite/mqlite.toml"]
