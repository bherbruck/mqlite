services:
  mqlite:
    image: ghcr.io/bherbruck/mqlite
    build: .
    ports:
      - 1883:1883
      - 8883:8883 # TLS
      - 8083:8083 # WebSocket
      - 8084:8084 # Secure WebSocket
      - 9090:9090 # Prometheus metrics
    volumes:
      - mqlite_data:/var/lib/mqlite
      # Mount TLS certs if needed:
      # - ./certs:/etc/mqlite/certs:ro
    environment:
      # Set to 0 for unbounded
      - MQLITE__LIMITS__MAX_INFLIGHT=0
      - MQLITE__LIMITS__MAX_CONNECTIONS=0
    ulimits:
      nofile:
        soft: 65536
        hard: 65536
    deploy:
      resources:
        limits:
          cpus: "4"
          memory: 8G
        reservations:
          cpus: "4"
          memory: 8G

volumes:
  mqlite_data:
